version: '3.8'

services:
  breathable-commute:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: breathable-commute-dashboard
    ports:
      - "8501:8501"
    environment:
      # Indian city coordinates
      - NEW_DELHI_LAT=28.6139
      - NEW_DELHI_LON=77.2090
      - MUMBAI_LAT=19.0760
      - MUMBAI_LON=72.8777
      - BENGALURU_LAT=12.9716
      - BENGALURU_LON=77.5946
      - HYDERABAD_LAT=17.3850
      - HYDERABAD_LON=78.4867
      
      # Air quality thresholds (μg/m³)
      - HEALTHY_AIR_QUALITY_THRESHOLD=50.0
      - HAZARDOUS_AIR_QUALITY_THRESHOLD=100.0
      
      # Weather thresholds
      - MODERATE_WIND_THRESHOLD=20.0
      - HIGH_WIND_THRESHOLD=30.0
      - HIGH_TEMPERATURE_THRESHOLD=35.0
      - COMFORTABLE_TEMPERATURE_THRESHOLD=30.0
      
      # API configuration
      - OPEN_METEO_AIR_QUALITY_URL=https://air-quality-api.open-meteo.com/v1/air-quality
      - OPEN_METEO_WEATHER_URL=https://api.open-meteo.com/v1/forecast
      - REQUEST_TIMEOUT=10
      - MAX_RETRIES=3
      - RETRY_DELAY=1.0
      
      # Performance and caching settings
      - CACHE_DURATION_SECONDS=300
      - MAX_CONCURRENT_REQUESTS=10
      - CONNECTION_POOL_SIZE=20
      - PERFORMANCE_MONITORING_ENABLED=true
      - AUTO_REFRESH_INTERVAL=30
      - SLOW_REQUEST_THRESHOLD=5.0
      
      # Responsive design settings
      - MOBILE_BREAKPOINT=768
      - TABLET_BREAKPOINT=1024
      - CHART_HEIGHT_MOBILE=300
      - CHART_HEIGHT_TABLET=400
      - CHART_HEIGHT_DESKTOP=500
      
      # Logging configuration
      - LOG_LEVEL=INFO
      - HEALTH_CHECK_ENABLED=true
      - HEALTH_CHECK_TIMEOUT=5
      
      # Application settings
      - APP_NAME=Breathable Commute
      - APP_VERSION=1.0.0
      
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - breathable-commute-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.breathable-commute.rule=Host(`breathable-commute.local`)"
      - "traefik.http.services.breathable-commute.loadbalancer.server.port=8501"

  # Optional: Add a reverse proxy for production deployment
  # nginx:
  #   image: nginx:alpine
  #   container_name: breathable-commute-nginx
  #   ports:
  #     - "80:80"
  #     - "443:443"
  #   volumes:
  #     - ./nginx.conf:/etc/nginx/nginx.conf:ro
  #     - ./ssl:/etc/nginx/ssl:ro
  #   depends_on:
  #     - breathable-commute
  #   networks:
  #     - breathable-commute-network
  #   restart: unless-stopped

networks:
  breathable-commute-network:
    driver: bridge

# Optional: Add volumes for persistent data
# volumes:
#   app-logs:
#     driver: local